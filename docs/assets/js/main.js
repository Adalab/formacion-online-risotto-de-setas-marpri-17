"use strict";const recipesPath="./assets/services/recipes.json",mixCheckboxes=document.querySelectorAll(".js-mix-check"),mixIngredientsList=document.querySelector(".js-list");let availableRecipes=[],testValueSelectedRecipe="00";function getRecipes(){return fetch(recipesPath).then(e=>e.json()).then(e=>{e=formatData(e),saveDatainRecipes(e),paintMixForSelectedOption(),readCheckboxesItemsandQuantity(e[0])}).catch(e=>console.log(e))}function formatData(e){let t=[];for(let s=0;s<e.length;s++)e[s].id=`0${s}`,t.push(e[s]);return console.log(t),t}const saveDatainRecipes=e=>availableRecipes=e;function paintMixForSelectedOption(){if(testValueSelectedRecipe){let e=availableRecipes.find(e=>e.id===testValueSelectedRecipe);const t=e.currency;e.ingredients.map(e=>{const s=`\n        <input class="form-check-input check js-mix-check results_list_checkboxes" type="checkbox" value="" id="" checked>\n        <input type="number" class="js-quantity results_list_quantitySelect" id="selectQuantity" value= "1" min="1"/>\n        <label for="selectQuantity" class="sr-only">Cantidad</label>\n       <label class="form-check-label results_list_labels" for="">\n           <div class="js-ingredient_name">${e.product}</div>\n           <div>${e.brand||"No disponible"}</div>\n           <span>${e.quantity}</span>\n           <div class="js-price">${e.price}<small> ${t}</small>\n       </label>\n       `,c=document.createElement("div");c.setAttribute("class","form-check flex-row flex-nowrap results__list_items js-ingredients"),c.innerHTML=s,mixIngredientsList.appendChild(c)}),addListenerToCheckboxes(),addListenerToQuantitySelects()}}function displayResults(e,t){const s=document.querySelector(".js-resultsubtotal"),c=document.querySelector(".js-resultshipcost"),i=document.querySelector(".js-resultstotal"),n=document.querySelectorAll(".js-currency");t=dosDecimales(t),s.innerHTML=`${t}`;let l=0;for(let t of availableRecipes)t.id===e.id&&(n.forEach(e=>e.innerHTML=` ${t.currency}`),l=t["shipping-cost"]);c.innerHTML=l;let a=dosDecimales(parseFloat(t)+l);i.innerHTML=a}function calculatePrices(e){let t=0;for(let s of availableRecipes)s.id===e.id&&s.ingredients.map(s=>{if(Object.keys(e).includes(s.product)){let c=s.price*e[s.product];t+=c}});return displayResults(e,t)}function readCheckboxesItemsandQuantity(){if(testValueSelectedRecipe){let e=availableRecipes.find(e=>e.id===testValueSelectedRecipe),t=new Object,s=e.id;t.id=s;let c=document.querySelectorAll(".js-ingredients");for(let e of c){if(e.querySelector(".js-mix-check").checked){let s=e.querySelector(".js-ingredient_name").textContent,c=1;c=parseInt(e.querySelector(".js-quantity").value)<1?0:parseInt(e.querySelector(".js-quantity").value),"shipping-cost"===s&&(t[s]=c),t[s]=c}}return calculatePrices(t)}}function handleCheckBoxes(){readCheckboxesItemsandQuantity(recipe)}function addListenerToCheckboxes(){document.querySelectorAll(".js-mix-check").forEach(e=>e.addEventListener("click",readCheckboxesItemsandQuantity))}function addListenerToQuantitySelects(){document.querySelectorAll(".js-quantity").forEach(e=>e.addEventListener("change",readCheckboxesItemsandQuantity))}function dosDecimales(e){return e.toString().match(/(\d*.\d{0,2})/)[0]}getRecipes();